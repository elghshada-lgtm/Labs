#include <iostream>
#include <vector>
#include <iomanip>


class TicTacToe {
private:
    // A 3x3 2D array to represent the game board.
    char board[3][3];
    
    // Tracks the current player's symbol ('X' or 'O').
    char currentPlayer;
    
    // Counts the number of moves made, used for draw detection.
    int moveCount;

    /*
      -switches the current player from 'X' to 'O' or vice-versa.
     */
    void switchPlayer() {
        currentPlayer = (currentPlayer == 'X') ? 'O' : 'X';
    }

public:
    /*
     * Constructor for the TicTacToe class.
     * Initializes the board and sets the starting player and move count.
     */
    TicTacToe() {
        // Initialize the board with empty spaces
        for (int i = 0; i < 3; ++i) {
            for (int j = 0; j < 3; ++j) {
                board[i][j] = ' ';
            }
        }
        // Player 1 ('X') always starts
        currentPlayer = 'X'; 
        moveCount = 0;
    }

    /*
     - Displays the current state of the game board to the console.
     */
    void displayBoard() const {
        std::cout << "+------------------+\n";
        std::cout << "|     TicTacToe    |\n";
        std::cout << "+------------------+\n";
        for (int i = 0; i < 3; ++i) {
            std::cout << " " << board[i][0] << " | " << board[i][1] << " | " << board[i][2] << " \n";
            
            // Print horizontal separator lines, but not after the last row
            if (i < 2) {
                std::cout << "---|---|---\n";
            }
        }
        std::cout << "---------------------------\n\n";
    }

    /*
     - Checks if a move (row, col) is valid.
     - true if the cell is within bounds and is empty (' ').
     */
    bool isValidMove(int row, int col) const {
        // Convert 1-based input (1-3) to 0-based array indices (0-2)
        int r = row - 1;
        int c = col - 1;
        
        // 1. Check if the row and column are within the valid range [0, 2]
        if (r < 0 || r > 2 || c < 0 || c > 2) {
            return false;
        }
        
        // 2. Check if the cell is currently empty
        return board[r][c] == ' ';
    }

    void makeMove(int row, int col) {
        // Convert 1-based input to 0-based array indices
        int r = row - 1;
        int c = col - 1;

        // Place the current player's symbol ('X' or 'O')
        board[r][c] = currentPlayer;
        
        // Increment the move count
        moveCount++;
    }

    /*
     - Checks if the current player has won the game.
     - Checks all rows, columns, and two diagonals.
     - True if the current player has three in a row.
     */
    bool checkWinner() const {
        // Check Rows and Columns
        for (int i = 0; i < 3; ++i) {
            if (board[i][0] == currentPlayer && board[i][1] == currentPlayer && board[i][2] == currentPlayer) {
                return true;
            }
            if (board[0][i] == currentPlayer && board[1][i] == currentPlayer && board[2][i] == currentPlayer) {
                return true;
            }
        }

        // Check Diagonals
        // 1. Top-Left to Bottom-Right: board[0][0], board[1][1], board[2][2]
        if (board[0][0] == currentPlayer && board[1][1] == currentPlayer && board[2][2] == currentPlayer) {
            return true;
        }
        
        // 2. Top-Right to Bottom-Left: board[0][2], board[1][1], board[2][0]
        if (board[0][2] == currentPlayer && board[1][1] == currentPlayer && board[2][0] == currentPlayer) {
            return true;
        }

        return false;
    }

    bool isDraw() const {
        // A draw is only possible if all 9 cells are filled
        return moveCount == 9;
    }

    // Contains the main game loop, handling turns, input, and game termination.
    
    void playGame() {
        int row, col;
        bool game_over = false;

        std::cout << "======================================\n";
        std::cout << "        Welcome to TicTacToe!         \n";
        std::cout << "Player 1 is 'X', Player 2 is 'O'.     \n";
        std::cout << "Enter moves as Row and Column (1-3).  \n";
        std::cout << "======================================\n";

        // Main game loop: continues until a winner is found or it's a draw
        while (!game_over) {
            displayBoard();
            
            std::cout << "Player " << currentPlayer << "'s turn. Enter row and column (example: 1 3): ";
            
            // Input loop: ensures the user enters a valid, available move
            while (!(std::cin >> row >> col) || !isValidMove(row, col)) {
                // Handle non-integer input
                if (std::cin.fail()) {
                    std::cin.clear(); // Clear error flags
                    std::cin.ignore(10000, '\n'); // Discard bad input
                    std::cout << "Invalid input. Please enter whole numbers only (example: 1 3): ";
                } 
                // Handle out-of-bounds or already occupied cell
                else {
                    std::cout << "Invalid move. This spot is already taken or out of bounds. Try again: ";
                }
            }

            // 1. Make the move on the board
            makeMove(row, col);

            // 2. Check for win condition
            if (checkWinner()) {
                displayBoard();
                std::cout << "--------------------------------\n";
                std::cout << "ðŸŽ‰ Player " << currentPlayer << " Wins! Congratulations! ðŸŽ‰\n";
                std::cout << "--------------------------------\n";
                game_over = true;
            } 
            // 3. Check for draw condition
            else if (isDraw()) {
                displayBoard();
                std::cout << "--------------------------------\n";
                std::cout << "It's a Draw! The board is full.\n";
                std::cout << "--------------------------------\n";
                game_over = true;
            } 
            // 4. If game continues, switch turn
            else {
                switchPlayer();
            }
        }
    }
};

/*
 * The main function to start the Tic-Tac-Toe game.
 */
int main() {
    // Create an instance of the TicTacToe class
    TicTacToe game;
    
    // Start the game loop
    game.playGame();
    
    return 0;
}
